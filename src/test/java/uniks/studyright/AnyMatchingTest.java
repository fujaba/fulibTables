package uniks.studyright;

import org.fulib.FulibTables;
import org.fulib.patterns.PatternBuilder;
import org.fulib.patterns.PatternMatcher;
import org.fulib.patterns.model.PatternObject;
import org.fulib.tables.ObjectTable;
import org.junit.Before;
import org.junit.Test;
import uniks.studyright.model.Student;
import uniks.studyright.model.University;

public class AnyMatchingTest
{
   private Object[] roots;
   private University studyRight;
   private Student alice;
   private Student bob;

   @Before
   public void scenario()
   {
      // --- end of code generated by solution scenario ---
      University studyRight = new University();
      studyRight.setName("StudyRight");

      Student alice = new Student();
      alice.setName("Alice");
      alice.setCredits(20);

      Student bob = new Student();
      bob.setName("Bob");
      bob.setCredits(10);

      studyRight.withStudents(alice, bob);
      // --- end of code generated by solution scenario ---

      this.studyRight = studyRight;
      this.alice = alice;
      this.bob = bob;
      // captured by fulibScenarios
      this.roots = new Object[] { studyRight, alice, bob };
   }

   @Test
   public void testUnknownObjectsUnknownAttributes()
   {
      final String packageName = University.class.getPackage().getName();

      final PatternBuilder builder = FulibTables.patternBuilder(packageName);

      // We expect that there is some object studyRight
      final PatternObject studyRight = builder.buildPatternObject("studyRight");

      // that has some attribute with value "StudyRight".
      final PatternObject studyRightAttr1 = builder.buildPatternObject("studyRightAttr1");
      builder.buildEqualityConstraint(studyRightAttr1, "StudyRight");
      builder.buildPatternLink(studyRight, null, "*", studyRightAttr1);

      // We expect that there is some object alice
      final PatternObject alice = builder.buildPatternObject("alice");

      // that has some attribute with value "Alice"
      final PatternObject aliceAttr1 = builder.buildPatternObject("aliceAttr1");
      builder.buildEqualityConstraint(aliceAttr1, "Alice");
      builder.buildPatternLink(alice, null, "*", aliceAttr1);

      // and that has some attribute with value 10.
      final PatternObject aliceAttr2 = builder.buildPatternObject("aliceAttr2");
      builder.buildEqualityConstraint(aliceAttr2, 20.0);
      builder.buildPatternLink(alice, null, "*", aliceAttr2);

      // We expect that there is some object bob
      final PatternObject bob = builder.buildPatternObject("bob");

      // that has some attribute with value "Bob"
      final PatternObject bobName = builder.buildPatternObject("bobName");
      builder.buildEqualityConstraint(bobName, "Bob");
      builder.buildPatternLink(bob, null, "*", bobName);

      // and that has some attribute with value 20.
      final PatternObject bobCredits = builder.buildPatternObject("bobCredits");
      builder.buildEqualityConstraint(bobCredits, 10.0);
      builder.buildPatternLink(bob, null, "*", bobCredits);

      // We expect that studyRight has some link to alice and bob.
      builder.buildPatternLink(studyRight, null, "*", alice);
      builder.buildPatternLink(studyRight, null, "*", bob);

      // Do match

      PatternMatcher matcher = FulibTables.matcher(builder.getPattern());

      ObjectTable start = matcher.match("studyRight", this.roots);

      System.out.println(start);
   }
}
